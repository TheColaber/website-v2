<!DOCTYPE html>

<html lang="en">

<head>

<title>addon.tab.traps - Scratch Addons</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="description" content="" />
<meta name="author" content="" />
<link rel="icon" href="/assets/img/icon.png">

<meta property="og:type" content="website" />
<meta property="og:url" content="https://scratchaddons.comdocs/developing/">
<meta property="og:title" content='addon.tab.traps' />
<meta property="og:description" content="">
<meta property="og:site_name" content='Scratch Addons' />
<meta property="og:locale" content="en" />
<meta property="og:image" content="https://scratchaddons.com/assets/img/icon-square.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="384" />
<meta property="og:image:height" content="384" />
<meta property="og:image:alt" content='Scratch Addons logo' />

<meta name="twitter:card" content="summary" />

<meta name="twitter:url" content="https://scratchaddons.github.iodocs/developing/" />
<meta name="twitter:title" content='addon.tab.traps - Scratch Addons' />
<meta name="twitter:description" content="" />
<meta name="twitter:image" content="https://scratchaddons.com/assets/img/icon-square.png" />
<meta name="twitter:image:alt" content='Scratch Addons logo' />




<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin />

<link rel="stylesheet" href="/assets/css/base.css" />


<script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.5.1,npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js,npm/@iconify/iconify@1.0.7,npm/bowser@2.11.0" crossorigin></script>

<script async src="/assets/js/website-base.js"></script>




</head>

<body><header>

	<nav class="navbar navbar-expand-md navbar-dark">
		
		<a href='/' class="navbar-brand">
			<img src="/assets/img/icon.svg" alt='Scratch Addons'></img>
			<span>Scratch Addons</span>
		</a>
	
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsible" aria-controls="collapsible" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
	  	</button>
	
		<div class="collapse navbar-collapse" id="collapsible">
			<ul class="navbar-nav ml-md-auto">
				
				<li class="nav-item"><a class="nav-link" href='/contributors'>Contributors</a></li>
				<li class="nav-item"><a class="nav-link" href='/feedback'>Send Feedback</a></li>
				<li class="nav-item"><a class="nav-link" href='/docs'>Docs</a></li>
				<li class="nav-item"><a class="nav-link" href="https://github.com/ScratchAddons/ScratchAddons" aria-label="Repository on GitHub" rel="noopener">Repository <span class="iconify" data-icon="simple-icons:github"></span></a></li>
				<li class="nav-item" id="install-nav"><a class="nav-link install-btn ml-md-2" href='/#install'>Install</a></li>
			</ul>
		</div>
	
	</nav>
	
</header>
<link rel="stylesheet" href="/assets/css/docs/base.css" />

<div class="content container-fluid">

  

	<main class="row">

	<aside class="docs-sidebar d-flex col-lg-3 col-xl-2">
			<nav class="docs-nav" aria-label="Docs navigation">

	<ul class="docs-nav-list text-muted"><li class="docs-nav-section">
		<span><a href="/docs/" class="docs-nav-page pl-0 pr-2 active">Home</a>
		</span>
		<ul class="docs-nav-section-pages collapse show" id="docs-nav-section-pages-docs">
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docschrome-web-store-privacy-information" href="/docs/chrome-web-store-privacy-information/">Chrome Web Store Privacy Information</a>
					</li><li class="docs-nav-section">
		<span><a class="collapse-button" data-toggle="collapse" href="#docs-nav-section-pages-docsdeveloping" role="button" aria-expanded="true"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="#626262"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8L4.646 2.354a.5.5 0 0 1 0-.708z"/></g></svg></a> 
			<a href="/docs/developing/" class="docs-nav-page pl-0 pr-2 active">Developing</a>
		</span>
		<ul class="docs-nav-section-pages collapse show" id="docs-nav-section-pages-docsdeveloping"><li class="docs-nav-section">
		<span><a class="collapse-button collapsed" data-toggle="collapse" href="#docs-nav-section-pages-docsdevelopinggetting-started" role="button" aria-expanded="true"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="#626262"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8L4.646 2.354a.5.5 0 0 1 0-.708z"/></g></svg></a> 
			<a href="/docs/developing/getting-started/" class="docs-nav-page pl-0 pr-2 collapsed">Getting Started</a>
		</span>
		<ul class="docs-nav-section-pages collapse " id="docs-nav-section-pages-docsdevelopinggetting-started">
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopinggetting-startedaddon-basics" href="/docs/developing/getting-started/addon-basics/">Addon Basics</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopinggetting-startedcreating-an-addon" href="/docs/developing/getting-started/creating-an-addon/">Creating an addon</a>
					</li>
		</ul>
	</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopingabout-persistent-scripts" href="/docs/developing/about-persistent-scripts/">About Persistant Scripts</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopingabout-userscripts" href="/docs/developing/about-userscripts/">About Userscripts</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopingabout-userstyles" href="/docs/developing/about-userstyles/">About Userstyles</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopingaddon-apis-reference" href="/docs/developing/addon-apis-reference/">Addon APIs Reference</a>
					</li>
					<li>
						<a class="docs-nav-page active" id="docs-nav-page-docsdevelopingaddontabtraps" href="/docs/developing/addon.tab.traps/">addon.tab.traps</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopingdesign" href="/docs/developing/design/">Design</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopinghow-to-add-an-icon-to-a-setting-name" href="/docs/developing/how-to-add-an-icon-to-a-setting-name/">How to add an icon to a setting name</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopinginstalling-scratch-addons" href="/docs/developing/installing-scratch-addons/">Installing Scratch Addons</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopingredux" href="/docs/developing/redux/">Redux</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docsdevelopingthe-addon-manifest-addonjson" href="/docs/developing/the-addon-manifest-addon.json/">The addon manifest (addon.json)</a>
					</li>
		</ul>
	</li><li class="docs-nav-section">
		<span><a class="collapse-button collapsed" data-toggle="collapse" href="#docs-nav-section-pages-docslocalization" role="button" aria-expanded="true"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="#626262"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8L4.646 2.354a.5.5 0 0 1 0-.708z"/></g></svg></a> 
			<a href="/docs/localization/" class="docs-nav-page pl-0 pr-2 collapsed">Localization</a>
		</span>
		<ul class="docs-nav-section-pages collapse " id="docs-nav-section-pages-docslocalization">
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docslocalizationhow-to-join-the-localization-team" href="/docs/localization/how-to-join-the-localization-team/">How to join the localization team</a>
					</li>
					<li>
						<a class="docs-nav-page" id="docs-nav-page-docslocalizationlocalizing-addons" href="/docs/localization/localizing-addons/">Localizing Addons</a>
					</li>
		</ul>
	</li>
		</ul>
	</li></ul>

</nav></aside>
	
		<article class="docs-main col col-lg-9 col-xl-8">

			<h1>addon.tab.traps</h1>
			<h1 id="this-page-is-out-of-date-and-is-in-need-of-a-rewrite-if-you-know-anything-about-traps-please-contribute">This page is out of date and is in need of a rewrite. If you know anything about traps, please contribute! <a href="#this-page-is-out-of-date-and-is-in-need-of-a-rewrite-if-you-know-anything-about-traps-please-contribute" class="anchor" aria-label="Anchor"></a></h1><p><code>addon.tab.traps</code> is a public API for userscripts that can be used to obtain objects that are not otherwise available. The actual traps are coded at <a href="https://github.com/ScratchAddons/ScratchAddons/blob/master/content-scripts/prototype-handler.js">prototype-handler</a>.</p>
<p>They share some APIs with &ldquo;Once&rdquo; traps, but is very different and is documented at <a href="Fake-redux-state">Fake redux state</a> separately.</p>
<h1 id="examples">Examples <a href="#examples" class="anchor" aria-label="Anchor"></a></h1><p><a href="https://github.com/ScratchAddons/ScratchAddons/blob/master/addons/editor-stepping/userscript.js">editor-stepping</a> addon shows how to manipulate <code>Thread</code> object trapped.</p>
<h1 id="trap-terminology">Trap terminology <a href="#trap-terminology" class="anchor" aria-label="Anchor"></a></h1><p>There are two types of traps, named after how many times they get trapped. Singleton instance like VM or ScratchBlocks get trapped only once per trap, so they are called &ldquo;Once&rdquo;. Objects like Thread can get trapped multiple times, so they are called &ldquo;Many&rdquo;.</p>
<p>Difference between Once and Many is simple: the addon only stores reference for Once.</p>
<h1 id="trappable-object">Trappable Object <a href="#trappable-object" class="anchor" aria-label="Anchor"></a></h1><table>
<thead>
<tr>
<th>Trap name</th>
<th>Description</th>
<th>Once/Many</th>
</tr>
</thead>
<tbody>
<tr>
<td>vm</td>
<td>Scratch VM, trapped by Function.prototype.bind</td>
<td>Once</td>
</tr>
<tr>
<td>vm.propsVMBind</td>
<td>Scratch VM, trapped from props.vm using bind</td>
<td>Once</td>
</tr>
<tr>
<td>vm.propsVMAssign</td>
<td>Scratch VM, trapped from props.vm using assign</td>
<td>Once</td>
</tr>
<tr>
<td>thread</td>
<td>Thread object used in Scratch VM</td>
<td>Many</td>
</tr>
<tr>
<td>ScratchBlocks</td>
<td>ScratchBlocks object</td>
<td>Once</td>
</tr>
<tr>
<td>workspace</td>
<td>ScratchBlocks workspace</td>
<td>Once</td>
</tr>
</tbody>
</table>
<h1 id="addontabtrapsoncevalues">addon.tab.traps.onceValues <a href="#addontabtrapsoncevalues" class="anchor" aria-label="Anchor"></a></h1><p><code>onceValues</code> attribute of <code>addon.tab.traps</code> stores references for &ldquo;Once&rdquo; traps. It is an prototypeless object - e.g. you cannot call <code>onceValues.hasOwnProperty()</code>.</p>
<p>Keys are the &ldquo;trap name&rdquo; listed above, and values are the trapped values.</p>
<p>Example: to get VM object, use <code>addon.tab.traps.onceValues.vm</code></p>
<h1 id="events">Events <a href="#events" class="anchor" aria-label="Anchor"></a></h1><p><code>addon.tab.traps</code> itself is not an <code>EventTarget</code>. However, it&rsquo;s possible to add or remove listeners, by using some public APIs. <code>traps.addOnceListener</code>/<code>removeOnceListener</code> is for &ldquo;Once&rdquo; traps, and <code>addManyListener</code>/<code>removeManyListener</code> is for &ldquo;Many&rdquo; traps. Note that listeners for &ldquo;Once&rdquo; objects can fire multiple times under some conditions, and may never fire if the object is trapped before loading the userscript.</p>
<p>These methods work like <code>addEventListener</code>/<code>removeEventListener</code>, but third argument is not supported at all. The first argument is for trap name; for example, if it needs to be fired when <code>thread</code> is trapped, do <code>addManyListener(&quot;thread&quot;, callback)</code>. The second argument is callback function that can take one argument for CustomEvent object, which contains the trapped value.</p>
<p>The CustomEvent object passed to callback always has <code>value</code> attribute for trapped value, and may have <code>trapName</code> if the first argument for the listener is <code>*</code> (see below).</p>
<p>Special event: if the trap name passed to these methods is <code>*</code>, it will fire when any object for the category is trapped. For example, callback in <code>addOnceListener(&quot;*&quot;, callback)</code> gets fired whenever an object in Once category is trapped. To check what is trapped, the CustomEvent passed to the callback also has <code>trapName</code> attribute for the trap name.</p>
	

		</article>

		<aside class="docs-toc text-muted d-none d-xl-flex col-xl-2"> 
			
			<nav id="TableOfContents"></nav>
		</aside>

	</main>


    
</div><a id="dark-toggle" class="btn" title='Click to toggle the dark theme.' aria-label='Dark theme switch button' data-toggle="tooltip" data-placement="left"></a>

<footer class="footer">
	<div class="container">
		<section class="footer-intro">
			<a href='/' class="navbar-brand mb-3">
				<img src="/assets/img/icon.svg" alt='Scratch Addons' class="mr-2"></img>
				<span>Scratch Addons</span>
			</a>
			<iframe src="https://ghbtns.com/github-btn.html?user=ScratchAddons&repo=ScratchAddons&type=star&count=true&size=large" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe>
			<iframe src="https://ghbtns.com/github-btn.html?user=ScratchAddons&repo=ScratchAddons&type=fork&count=true&size=large" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe>
		</section>
		<section>
			<h3>Header</h3>
			<a href='/faq'>FAQ</a>
			<a href='/feedback'>Send Feedback</a>
			<a href='/contributors'>Contributors</a>		
			<a href='/changelog'>Changelog</a>
			<a href='/addons'>Addons</a>
		</section>
		<section>
			<h3>Discuss</h3>
			<a href="https://github.com/ScratchAddons/ScratchAddons/discussions" rel="noopener"></a>
			<a href="https://github.com/ScratchAddons/ScratchAddons/issues" rel="noopener">Issues</a>
			<a href="https://discord.gg/R5NBqwMjNc" rel="noopener">Community Discord</a>
			<a href="https://discord.gg/Ak8sCDQ" rel="noopener">Development Discord</a>
		</section>
		<section>
			<h3>Resources</h3>
			<a href="https://github.com/ScratchAddons" rel="noopener">Organization</a>
			<a href="https://github.com/ScratchAddons/ScratchAddons" rel="noopener">Repository</a>
			<a href="https://github.com/ScratchAddons/ScratchAddons/wiki" rel="noopener">Documentation</a>
		</section>
		<section class="w-100 mt-3">
			<p>© 2021 Scratch Addons contributors</p>
			<p>Scratch Addons is not affiliated, associated, or in any way officially connected with Scratch, the Scratch Team, the Scratch Foundation, or any of its subsidiaries or its affiliates.</p>
			<p>Scratch Addons is licensed under the terms of GNU General Public License v3.0.</p>
		</section>
	</div>
</footer></body>

</html>
